#!/usr/bin/env ruby

require 'rubygems'
require 'thor'
require 'bundler'
require 'mccloud'

require 'mccloud/session'

class MccloudCLI < Thor 

  attr_accessor :all_servers
  no_tasks do
    def create_session
      @session=Mccloud::Session.new
      @session.load_config
    end

  end

  desc "init [AMI-ID]", "initializes a box from a template" 
  method_options :force => :boolean
  def init(amiId=nil)
  end

  desc "up", "bring a machine up"
  method_options :force => :boolean
  def up(selection=nil)
    create_session
    @session.up(selection)
  end
  
  desc "status", "show a status of all machines that are configured"
  method_options :verbose => false
  def status(selection=nil)
    create_session
    @session.status(selection,options)
  end

  desc "halt [NAME]", "shutdown the machine"
  method_options :force => :boolean  
  def halt(selection=nil)
    create_session
     @session.halt(selection,options)
  end
  
  desc "ssh [NAME]", "spawns an ssh to the machine"
   method_options :screen => :boolean  
   def ssh(selection=nil,command=nil)
    create_session
    @session.ssh(selection,command,options)
   end
   
  desc "suspend", "freeze"
  method_options :force => :boolean
  def suspend(selection=nil)
    create_session
    @session.suspend(selection,options)
  end

  desc "boot", "freeze"
  method_options :force => :boolean
  def boot(selection=nil)
    create_session
    @session.boot(selection,options)
  end

  desc "destroy [NAME]", "destroys the machine"
  method_options :force => :boolean  
  def destroy(selection=nil)
    create_session
    @session.destroy(selection,options)
  end

  desc "reload [NAME]", "reloads the machine"
  method_options :force => :boolean  
  def reload(selection=nil?)
    create_session
    @session.reload(selection,options)
  end

  desc "command [NAME] [COMMAND]", "exec a command on a box"
  method_options :parallel => :boolean
  def command(selection=nil,command="who am i")
    create_session
    @session.command(selection,command,options)
  end

  desc "bootstrap [NAME]", "exec a command on a box"
  method_options :sudo => :boolean      
  def bootstrap(selection=nil,script="who am i")
    create_session
    @session.bootstrap(selection,script,options)
  end

  desc "multi","multi"
  method_options :verbose => :boolean  
  def multi(selection=nil,command="who am i")
    create_session
    @session.multi(selection,command,options)
  end  

  desc "provision", "provision the machine"
  def provision(selection=nil)
    create_session
    @session.provision(selection,command,options)
  end

end

MccloudCLI.start